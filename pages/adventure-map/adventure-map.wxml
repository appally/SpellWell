<!-- pages/adventure-map/adventure-map.wxml -->

<view class="adventure-page">
  <!-- çº¸å¼ è´¨æ„ŸèƒŒæ™¯ -->
  <view class="paper-background"></view>
  
  <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card jelly-card">
    <view class="user-avatar-container">
      <view class="user-avatar">{{userInfo.avatar}}</view>
      <view class="user-level-badge">Lv.{{currentLevel}}</view>
    </view>
    <view class="user-info">
      <view class="user-name">{{userInfo.name}}</view>
      <view class="user-grade">{{userInfo.grade}}</view>
      <view class="user-motto">å•è¯å°è¶…äººï¼ŒåŠ æ²¹å­¦ä¹ ï¼</view>
    </view>
    <!-- åœ†å½¢è¿›åº¦æ¡ -->
    <view class="circular-progress">
      <view class="progress-ring">
        <view class="progress-circle" style="--progress: {{progressPercentage}}%;"></view>
        <view class="progress-center">
          <view class="progress-number">{{userProgress}}</view>
          <view class="progress-total">/{{maxLevel}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- åœ°å›¾æ ‡é¢˜åŒºåŸŸ -->
  <view class="map-header">
    <view class="map-title">
      <text class="title-icon">ğŸ—ºï¸</text>
      <text class="title-text">å†’é™©åœ°å›¾</text>
      <view class="title-sparkles">
        <view class="sparkle sparkle-1">âœ¨</view>
        <view class="sparkle sparkle-2">â­</view>
        <view class="sparkle sparkle-3">ğŸ’«</view>
      </view>
    </view>
    <view class="map-subtitle">é€‰æ‹©å…³å¡å¼€å§‹ä½ çš„å•è¯å†’é™©ä¹‹æ—…</view>
  </view>

  <!-- å†’é™©åœ°å›¾å®¹å™¨ -->
  <view class="map-scroll-container">
    <scroll-view class="map-scroll" scroll-y enhanced show-scrollbar="{{false}}">
      <!-- åœ°å›¾è·¯å¾„èƒŒæ™¯ -->
      <view class="map-path">
        <canvas class="path-canvas" type="2d" id="pathCanvas"></canvas>
      </view>
      
      <!-- å…³å¡èŠ‚ç‚¹ç½‘æ ¼ -->
      <view class="levels-container">
        <view 
          class="level-node level-{{item.status}} {{item.status === 'current' ? 'current-bounce' : ''}}"
          wx:for="{{levels}}"
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="onLevelTap"
          style="animation-delay: {{index * 0.1}}s;"
        >
          <!-- å…³å¡èƒŒæ™¯åœ†ç¯ -->
          <view class="level-ring level-ring-{{item.status}}">
            <!-- å…³å¡å›¾æ ‡å®¹å™¨ -->
            <view class="level-icon-container">
              <view class="level-icon">{{item.icon}}</view>
            </view>
            
            <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
            <view class="level-status-indicator" wx:if="{{item.status === 'completed'}}">
              <view class="status-icon">â­</view>
            </view>
            <view class="level-status-indicator" wx:if="{{item.status === 'current'}}">
              <view class="status-icon current-pulse">ğŸ‘‘</view>
            </view>
            <view class="level-status-indicator lock-indicator" wx:if="{{item.status === 'locked'}}">
              <view class="status-icon">ğŸ”’</view>
            </view>
          </view>
          
          <!-- å…³å¡ä¿¡æ¯å¡ç‰‡ -->
          <view class="level-info-card">
            <view class="level-number">ç¬¬{{item.id}}å…³</view>
            <view class="level-name">{{item.name}}</view>
          </view>
          
          <!-- è¿æ¥çº¿ -->
          <view class="level-connector" wx:if="{{index < levels.length - 1}}"></view>
        </view>
      </view>
      
      <!-- è£…é¥°å…ƒç´  -->
      <view class="map-decorations">
        <view class="decoration cloud cloud-1">â˜ï¸</view>
        <view class="decoration cloud cloud-2">â˜ï¸</view>
        <view class="decoration tree tree-1">ğŸŒ³</view>
        <view class="decoration tree tree-2">ğŸŒ²</view>
        <view class="decoration mountain">â›°ï¸</view>
        <view class="decoration castle">ğŸ°</view>
      </view>
    </scroll-view>
  </view>

</view>

<!-- å…³å¡è¯¦æƒ…å¼¹çª— -->
<view class="level-preview-overlay {{showLevelPreview ? 'show' : ''}}" bindtap="onPreviewMaskTap" wx:if="{{showLevelPreview}}">
  <view class="level-preview-card jelly-card" catchtap="">
    <!-- å…³å¡é¢„è§ˆå¤´éƒ¨ -->
    <view class="preview-header">
      <view class="preview-level-ring level-ring-{{previewData.status}}">
        <view class="preview-icon">{{previewData.icon}}</view>
      </view>
      <view class="preview-close" bindtap="onClosePreview">âœ•</view>
    </view>
    
    <!-- å…³å¡ä¿¡æ¯ -->
    <view class="preview-content">
      <view class="preview-title">{{previewData.title}}</view>
      <view class="preview-description">{{previewData.description}}</view>
      
      <!-- å…³å¡ç»Ÿè®¡ -->
      <view class="preview-stats">
        <view class="stat-item">
          <view class="stat-icon">ğŸ“–</view>
          <view class="stat-label">å•è¯æ•°é‡</view>
          <view class="stat-value">{{previewData.wordCount}}</view>
        </view>
        <view class="stat-item">
          <view class="stat-icon">â­</view>
          <view class="stat-label">æœ€ä½³æˆç»©</view>
          <view class="stat-value">{{previewData.bestScore || '--'}}%</view>
        </view>
        <view class="stat-item">
          <view class="stat-icon">â±ï¸</view>
          <view class="stat-label">é¢„è®¡æ—¶é—´</view>
          <view class="stat-value">{{previewData.estimatedTime || '5'}}åˆ†é’Ÿ</view>
        </view>
      </view>
    </view>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="preview-actions">
      <button class="preview-btn btn-secondary jelly-btn" bindtap="onClosePreview">
        <view class="btn-content">
          <text class="btn-icon">ğŸ“–</text>
          <text class="btn-text">é¢„ä¹ å•è¯</text>
        </view>
      </button>
      <button class="preview-btn btn-primary jelly-btn" bindtap="onStartLevel">
        <view class="btn-content">
          <text class="btn-icon">ğŸš€</text>
          <text class="btn-text">å¼€å§‹å†’é™©</text>
        </view>
        <view class="btn-glow"></view>
      </button>
    </view>
  </view>
</view>