<!-- pages/statistics/statistics.wxml -->

<view class="safe-area">
  <!-- é¡¶éƒ¨ä¿¡æ¯å¡ç‰‡ -->
  <view class="header-card card">
    <image class="user-avatar" src="/images/logo.png" mode="aspectFit"></image>
    <view class="user-info">
      <view class="user-name font-display">å•è¯å°è¶…äºº</view>
      <view class="user-level text-secondary">ç¬¬{{overallStats.currentLevel}}å…³</view>
    </view>
    <view class="header-actions">
      <button class="icon-btn" bindtap="onBackToMap">
        ğŸ—ºï¸
      </button>
      <button class="icon-btn" open-type="share" bindtap="onShareResults">
        ğŸ“¤
      </button>
    </view>
  </view>

  <!-- é€‰é¡¹å¡å¯¼èˆª -->
  <view class="tab-nav">
    <view 
      class="tab-item {{selectedTab === 'overview' ? 'active' : ''}}"
      data-tab="overview"
      bindtap="onTabChange"
    >
      æ€»è§ˆ
    </view>
    <view 
      class="tab-item {{selectedTab === 'progress' ? 'active' : ''}}"
      data-tab="progress"
      bindtap="onTabChange"
    >
      è¿›åº¦
    </view>
    <view 
      class="tab-item {{selectedTab === 'achievements' ? 'active' : ''}}"
      data-tab="achievements"
      bindtap="onTabChange"
    >
      æˆå°±
    </view>
    <view 
      class="tab-item {{selectedTab === 'charts' ? 'active' : ''}}"
      data-tab="charts"
      bindtap="onTabChange"
    >
      å›¾è¡¨
    </view>
  </view>

  <!-- æ€»è§ˆé¡µé¢ -->
  <view class="tab-content" wx:if="{{selectedTab === 'overview'}}">
    <!-- æ ¸å¿ƒç»Ÿè®¡æ•°æ® -->
    <view class="stats-grid">
      <view class="stat-card">
        <view class="stat-icon">ğŸ“š</view>
        <view class="stat-value">{{overallStats.totalWords}}</view>
        <view class="stat-label">å­¦ä¼šå•è¯</view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">ğŸ¯</view>
        <view class="stat-value">{{overallStats.accuracy}}%</view>
        <view class="stat-label">å‡†ç¡®ç‡</view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">âš¡</view>
        <view class="stat-value">{{overallStats.streak}}</view>
        <view class="stat-label">è¿å‡»è®°å½•</view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">ğŸ”¥</view>
        <view class="stat-value">{{overallStats.studyDays}}</view>
        <view class="stat-label">å­¦ä¹ å¤©æ•°</view>
      </view>
    </view>

    <!-- æ¯æ—¥å­¦ä¹ æ•°æ® -->
    <view class="daily-stats card">
      <view class="card-header">
        <view class="card-title">ğŸ“Š è¿‘7å¤©å­¦ä¹ æƒ…å†µ</view>
      </view>
      <view class="daily-chart">
        <view class="chart-days">
          <view 
            class="day-item"
            wx:for="{{dailyStats}}"
            wx:key="date"
          >
            <view class="day-bar">
              <view 
                class="bar-fill"
                style="height: {{item.barHeight}}rpx; max-height: 100rpx;"
              ></view>
            </view>
            <view class="day-label">{{item.weekday}}</view>
            <view class="day-value">{{item.words}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¿«é€Ÿæ“ä½œ -->
    <view class="quick-actions card">
      <view class="card-header">
        <view class="card-title">âš¡ å¿«é€Ÿæ“ä½œ</view>
      </view>
      <view class="action-grid">
        <button class="action-btn" bindtap="onBackToMap">
          <view class="action-icon">ğŸ—ºï¸</view>
          <view class="action-text">ç»§ç»­å­¦ä¹ </view>
        </button>
        <button class="action-btn" bindtap="onExportData">
          <view class="action-icon">ğŸ“Š</view>
          <view class="action-text">å¯¼å‡ºæ•°æ®</view>
        </button>
        <button class="action-btn" open-type="share" bindtap="onShareResults">
          <view class="action-icon">ğŸ“¤</view>
          <view class="action-text">åˆ†äº«æˆç»©</view>
        </button>
        <button class="action-btn btn-danger" bindtap="onResetStats">
          <view class="action-icon">ğŸ”„</view>
          <view class="action-text">é‡ç½®æ•°æ®</view>
        </button>
      </view>
    </view>
  </view>

  <!-- è¿›åº¦é¡µé¢ -->
  <view class="tab-content" wx:if="{{selectedTab === 'progress'}}">
    <view class="progress-header card">
      <view class="progress-title">ğŸ¯ å…³å¡è¿›åº¦</view>
      <view class="progress-summary">
        å·²å®Œæˆ {{overallStats.currentLevel - 1}}/20 å…³
      </view>
    </view>

    <view class="levels-grid">
      <view 
        class="level-card {{item.status}}"
        wx:for="{{levelProgress}}"
        wx:key="level"
        data-level="{{item.level}}"
        bindtap="onLevelDetail"
      >
        <view class="level-number">{{item.level}}</view>
        <view class="level-theme">{{item.theme}}</view>
        <view class="level-words">{{item.totalWords}}è¯</view>
        <view class="level-stars">
          <view 
            class="star {{index < item.stars ? 'filled' : ''}}"
            wx:for="{{[1,2,3]}}"
            wx:key="*this"
            wx:for-index="index"
          >
            â­
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆå°±é¡µé¢ -->
  <view class="tab-content" wx:if="{{selectedTab === 'achievements'}}">
    <view class="achievements-header card">
      <view class="achievements-title">ğŸ† æˆå°±ç³»ç»Ÿ</view>
      <view class="achievements-summary">
        å·²è·å¾— {{completedAchievements}}/{{achievements.length}} ä¸ªæˆå°±
      </view>
    </view>

    <view class="achievements-list">
      <view 
        class="achievement-card {{item.completed ? 'completed' : ''}}"
        wx:for="{{achievements}}"
        wx:key="id"
      >
        <view class="achievement-icon">{{item.icon}}</view>
        <view class="achievement-info">
          <view class="achievement-title">{{item.title}}</view>
          <view class="achievement-desc">{{item.description}}</view>
          <view class="achievement-progress">
            <view class="progress-bar">
              <view 
                class="progress-fill"
                style="width: {{item.progressWidth}}%;"
              ></view>
            </view>
            <view class="progress-text">{{item.current}}/{{item.requirement}}</view>
          </view>
        </view>
        <view class="achievement-status">
          {{item.completed ? 'âœ…' : 'â³'}}
        </view>
      </view>
    </view>
  </view>

  <!-- å›¾è¡¨é¡µé¢ -->
  <view class="tab-content" wx:if="{{selectedTab === 'charts'}}">
    <view class="chart-section card">
      <view class="card-header">
        <view class="card-title">ğŸ“ˆ å­¦ä¹ è¶‹åŠ¿</view>
      </view>
      
      <!-- å‡†ç¡®ç‡å›¾è¡¨ -->
      <view class="chart-container">
        <view class="chart-title">å‡†ç¡®ç‡å˜åŒ–</view>
        <view class="line-chart">
          <view class="chart-grid">
            <view class="grid-line" wx:for="{{[100,80,60,40,20,0]}}" wx:key="*this">
              <view class="grid-label">{{item}}%</view>
              <view class="grid-line-bg"></view>
            </view>
          </view>
          <view class="chart-data">
            <view 
              class="data-point"
              wx:for="{{chartData.accuracy}}"
              wx:key="label"
              style="left: {{index * 14.3}}%; bottom: {{item.value}}%;"
            >
              <view class="point-dot"></view>
              <view class="point-label">{{item.label}}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- å­¦ä¹ å•è¯æ•°å›¾è¡¨ -->
      <view class="chart-container">
        <view class="chart-title">æ¯æ—¥å­¦ä¹ å•è¯æ•°</view>
        <view class="bar-chart">
          <view 
            class="bar-item"
            wx:for="{{chartData.words}}"
            wx:key="label"
          >
            <view class="bar-column">
              <view 
                class="bar-fill"
                style="height: {{item.barHeight}}rpx; max-height: 200rpx;"
              ></view>
            </view>
            <view class="bar-label">{{item.label}}</view>
            <view class="bar-value">{{item.value}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
</view>