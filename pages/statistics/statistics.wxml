<!-- pages/statistics/statistics.wxml -->

<view class="safe-area">
  <!-- 顶部信息卡片 -->
  <view class="header-card card">
    <image class="user-avatar" src="/images/logo.png" mode="aspectFit"></image>
    <view class="user-info">
      <view class="user-name font-display">单词小超人</view>
      <view class="user-level text-secondary">第{{overallStats.currentLevel}}关</view>
    </view>
    <view class="header-actions">
      <button class="icon-btn" bindtap="onBackToMap">
        <view class="emoji-icon emoji-map"></view>
      </button>
      <button class="icon-btn" open-type="share" bindtap="onShareResults">
        <view class="emoji-icon emoji-share"></view>
      </button>
    </view>
  </view>

  <!-- 错误统计概览 -->
  <view class="error-overview card">
      <view class="card-header">
        <view class="card-title">❌ 错误统计概览</view>
      </view>
      <view class="error-stats-grid">
        <view class="error-stat-item">
          <view class="error-stat-icon">📊</view>
          <view class="error-stat-value">{{totalErrors}}</view>
          <view class="error-stat-label">总错误次数</view>
        </view>
        <view class="error-stat-item">
          <view class="error-stat-icon">📝</view>
          <view class="error-stat-value">{{errorWords.length}}</view>
          <view class="error-stat-label">出错单词数</view>
        </view>
        <view class="error-stat-item">
          <view class="error-stat-icon">🎯</view>
          <view class="error-stat-value">{{averageErrors}}</view>
          <view class="error-stat-label">平均错误次数</view>
        </view>
      </view>
    </view>

    <!-- 最容易出错的单词列表 -->
    <view class="error-words-list card">
      <view class="card-header">
        <view class="card-title">🔍 最容易出错的单词</view>
        <view class="card-subtitle">发现你的薄弱环节</view>
      </view>
      
      <view class="error-words-container" wx:if="{{errorWords.length > 0}}">
        <view 
          class="error-word-item"
          wx:for="{{errorWords}}"
          wx:key="word"
          data-word="{{item.word}}"
          bindtap="onErrorWordDetail"
        >
          <view class="error-word-info">
            <view class="error-word-english">{{item.word}}</view>
          </view>
          <view class="error-count">{{item.totalErrors}}</view>
        </view>
      </view>
      
      <view class="empty-state" wx:else>
        <view class="empty-icon">🎉</view>
        <view class="empty-title">太棒了！</view>
        <view class="empty-desc">你还没有出错的单词，继续保持！</view>
      </view>
    </view>

  <!-- 加载状态 -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <view class="loading-text">加载中...</view>
  </view>
</view>