
// ==========================================
// 新的基于主题优先的关卡映射系统
// 生成时间: 2025-08-05T06:32:50.869Z
// 版本: 2.0.0
// ==========================================


/**
 * 新的基于主题优先的单词选择函数
 * 替换原有的按索引分配策略
 */
function selectWordsForLevel(level, config) {
  // 预定义的关卡映射（基于主题优先分配）
  const LEVEL_WORD_MAPPING = {
  "1": [
    "a",
    "i",
    "at",
    "be",
    "by",
    "do",
    "go",
    "he",
    "hi",
    "if",
    "in",
    "it",
    "me",
    "my",
    "no",
    "of",
    "on",
    "or",
    "so",
    "to",
    "up",
    "us",
    "we",
    "ago",
    "all",
    "and"
  ],
  "2": [
    "kid",
    "man",
    "aunt",
    "baby",
    "girl",
    "child",
    "uncle",
    "woman",
    "cousin",
    "family",
    "father",
    "friend",
    "mother",
    "parent",
    "sister",
    "any",
    "but",
    "can",
    "cut",
    "day",
    "far",
    "for",
    "get",
    "has",
    "her",
    "him"
  ],
  "3": [
    "arm",
    "eye",
    "leg",
    "body",
    "face",
    "hair",
    "hand",
    "head",
    "neck",
    "nose",
    "tail",
    "his",
    "how",
    "its",
    "let",
    "lot",
    "may",
    "new",
    "not",
    "now",
    "off",
    "old",
    "one",
    "our",
    "out",
    "put"
  ],
  "4": [
    "red",
    "blue",
    "pink",
    "black",
    "brown",
    "green",
    "white",
    "colour",
    "yellow",
    "see",
    "she",
    "sit",
    "six",
    "ten",
    "the",
    "too",
    "try",
    "use",
    "way",
    "who",
    "why",
    "yes",
    "you",
    "back",
    "come",
    "down"
  ],
  "5": [
    "eat",
    "egg",
    "tea",
    "cake",
    "cook",
    "food",
    "meal",
    "meat",
    "milk",
    "soup",
    "apple",
    "bread",
    "drink",
    "fresh",
    "fruit",
    "grape",
    "juice",
    "lunch",
    "snack",
    "water",
    "banana",
    "coffee",
    "dinner",
    "noodle",
    "potato",
    "tomato"
  ],
  "6": [
    "ask",
    "bag",
    "cap",
    "pen",
    "book",
    "read",
    "word",
    "class",
    "learn",
    "maths",
    "paper",
    "ruler",
    "story",
    "study",
    "write",
    "answer",
    "crayon",
    "lesson",
    "letter",
    "pencil",
    "school",
    "fast",
    "find",
    "free",
    "from",
    "give"
  ],
  "7": [
    "bed",
    "box",
    "cup",
    "hat",
    "key",
    "coat",
    "desk",
    "door",
    "fork",
    "home",
    "live",
    "room",
    "shoe",
    "wall",
    "wear",
    "chair",
    "clean",
    "clock",
    "dress",
    "floor",
    "glass",
    "house",
    "shirt",
    "skirt",
    "sweep",
    "table"
  ],
  "8": [
    "air",
    "hot",
    "ice",
    "sea",
    "sun",
    "cold",
    "lake",
    "moon",
    "park",
    "star",
    "warm",
    "wind",
    "beach",
    "river",
    "windy",
    "autumn",
    "cloudy",
    "forest",
    "garden",
    "season",
    "spring",
    "summer",
    "winter",
    "half",
    "have"
  ],
  "9": [
    "bird",
    "duck",
    "farm",
    "fish",
    "lion",
    "horse",
    "panda",
    "sheep",
    "animal",
    "monkey",
    "rabbit",
    "bee",
    "cat",
    "cow",
    "dog",
    "fly",
    "pig",
    "zoo",
    "elephant",
    "hear",
    "help",
    "here",
    "hers",
    "high",
    "hold"
  ],
  "10": [
    "doll",
    "film",
    "game",
    "gift",
    "kite",
    "play",
    "show",
    "hobby",
    "party",
    "visit",
    "watch",
    "cinema",
    "travel",
    "tv",
    "buy",
    "fan",
    "toy",
    "holiday",
    "birthday",
    "hour",
    "idea",
    "into",
    "keep",
    "know",
    "late"
  ],
  "11": [
    "miss",
    "sell",
    "shop",
    "work",
    "nurse",
    "teach",
    "doctor",
    "driver",
    "famous",
    "farmer",
    "worker",
    "mr",
    "job",
    "mrs",
    "student",
    "teacher",
    "hospital",
    "line",
    "long",
    "look",
    "many",
    "meet",
    "move",
    "much",
    "must"
  ],
  "12": [
    "ball",
    "jump",
    "p.e.",
    "race",
    "swim",
    "walk",
    "catch",
    "sport",
    "run",
    "football",
    "name",
    "near",
    "need",
    "next",
    "nine",
    "noon",
    "open",
    "ours",
    "over",
    "p.m.",
    "some",
    "stay",
    "step",
    "take",
    "talk"
  ],
  "13": [
    "station",
    "bike",
    "ship",
    "taxi",
    "plane",
    "train",
    "because",
    "between",
    "goodbye",
    "morning",
    "o'clock",
    "welcome",
    "tomorrow",
    "tell",
    "that",
    "them",
    "then",
    "they",
    "thin",
    "this",
    "time",
    "turn",
    "very",
    "wait",
    "wake"
  ],
  "14": [
    "chinese",
    "hometown",
    "china",
    "earth",
    "world",
    "street",
    "wash",
    "week",
    "what",
    "when",
    "will",
    "with",
    "year",
    "your",
    "about",
    "after",
    "again",
    "begin",
    "bring",
    "close",
    "early",
    "every",
    "forty",
    "front",
    "heavy"
  ],
  "15": [
    "sing",
    "song",
    "dance",
    "music",
    "piano",
    "listen",
    "hello",
    "light",
    "money",
    "month",
    "never",
    "night",
    "often",
    "place",
    "right",
    "seven",
    "short",
    "sleep",
    "small",
    "space",
    "speak",
    "stand",
    "start",
    "still",
    "thank"
  ],
  "16": [
    "science",
    "computer",
    "internet",
    "email",
    "robot",
    "their",
    "there",
    "these",
    "thing",
    "think",
    "those",
    "three",
    "today",
    "under",
    "where",
    "which",
    "whose",
    "young",
    "always",
    "before",
    "behind",
    "beside",
    "choose",
    "eleven",
    "excuse"
  ],
  "17": [
    "tree",
    "grass",
    "plant",
    "flower",
    "little",
    "middle",
    "minute",
    "people",
    "please",
    "should",
    "sunday",
    "theirs",
    "afternoon",
    "september",
    "sometimes",
    "yesterday",
    "brother",
    "careful",
    "chicken",
    "clothes",
    "english",
    "excited",
    "healthy",
    "history",
    "kitchen"
  ],
  "18": [
    "picture",
    "draw",
    "make",
    "photo",
    "library",
    "subject",
    "sweater",
    "weather",
    "homework",
    "question",
    "trousers",
    "umbrella",
    "best",
    "busy",
    "cool",
    "dear",
    "easy",
    "feel",
    "fine",
    "glad",
    "good",
    "hard",
    "hope",
    "hurt",
    "kind"
  ],
  "19": [
    "bad",
    "cry",
    "ill",
    "sad",
    "like",
    "neat",
    "nice",
    "safe",
    "sick",
    "want",
    "well",
    "dirty",
    "enjoy",
    "great",
    "happy",
    "hurry",
    "quiet",
    "sorry",
    "tired",
    "worry",
    "wrong",
    "hungry",
    "lovely",
    "pretty",
    "strong"
  ],
  "20": [
    "art",
    "bus",
    "car",
    "map",
    "candle",
    "window",
    "beautiful",
    "breakfast",
    "chocolate",
    "classmate",
    "classroom",
    "difficult",
    "favourite",
    "ice-cream",
    "ping-pong",
    "schoolbag",
    "vegetable",
    "wonderful",
    "basketball",
    "blackboard",
    "playground",
    "grandfather",
    "grandmother",
    "interesting",
    "supermarket"
  ]
};
  
  // 确保关卡在有效范围内
  if (level < 1 || level > 20) {
    level = 1;
  }
  
  // 获取预分配的单词
  const preAllocatedWords = LEVEL_WORD_MAPPING[level] || [];
  
  // 如果预分配的单词数量符合要求，直接返回
  if (preAllocatedWords.length >= config.targetWords) {
    return preAllocatedWords.slice(0, config.targetWords);
  }
  
  // 如果预分配单词不足，从基础词汇中补充
  const allWords = Object.keys(PRIMARY_WORD_DATABASE);
  const basicWords = allWords.filter(wordKey => {
    const word = PRIMARY_WORD_DATABASE[wordKey];
    return word.category === '基础词汇' && 
           word.difficulty === config.difficulty &&
           !preAllocatedWords.includes(wordKey);
  });
  
  const finalWords = [...preAllocatedWords];
  const needed = config.targetWords - finalWords.length;
  
  if (needed > 0) {
    finalWords.push(...basicWords.slice(0, needed));
  }
  
  return finalWords.slice(0, config.targetWords);
}


/**
 * 获取关卡映射统计信息
 */
function getLevelMappingStats() {
  return {
  "categoryDistribution": {
    "基础词汇": 200,
    "家庭成员": 18,
    "身体部位": 11,
    "颜色彩虹": 9,
    "美食天地": 31,
    "学习用品": 31,
    "家庭用品": 33,
    "自然景观": 24,
    "动物世界": 19,
    "娱乐活动": 20,
    "职业体验": 18,
    "运动健身": 12,
    "交通工具": 8,
    "世界地理": 7,
    "音乐艺术": 7,
    "科学探索": 5,
    "植物花卉": 4,
    "情感表达": 46,
    "艺术创作": 4
  },
  "difficultyDistribution": {
    "easy": 112,
    "medium": 334,
    "hard": 38,
    "advanced": 23
  },
  "levelWordCounts": [
    {
      "level": 1,
      "count": 26
    },
    {
      "level": 2,
      "count": 26
    },
    {
      "level": 3,
      "count": 26
    },
    {
      "level": 4,
      "count": 26
    },
    {
      "level": 5,
      "count": 26
    },
    {
      "level": 6,
      "count": 26
    },
    {
      "level": 7,
      "count": 26
    },
    {
      "level": 8,
      "count": 25
    },
    {
      "level": 9,
      "count": 25
    },
    {
      "level": 10,
      "count": 25
    },
    {
      "level": 11,
      "count": 25
    },
    {
      "level": 12,
      "count": 25
    },
    {
      "level": 13,
      "count": 25
    },
    {
      "level": 14,
      "count": 25
    },
    {
      "level": 15,
      "count": 25
    },
    {
      "level": 16,
      "count": 25
    },
    {
      "level": 17,
      "count": 25
    },
    {
      "level": 18,
      "count": 25
    },
    {
      "level": 19,
      "count": 25
    },
    {
      "level": 20,
      "count": 25
    }
  ]
};
}

/**
 * 验证关卡映射完整性
 */
function validateLevelMapping() {
  const LEVEL_WORD_MAPPING = {
  "1": [
    "a",
    "i",
    "at",
    "be",
    "by",
    "do",
    "go",
    "he",
    "hi",
    "if",
    "in",
    "it",
    "me",
    "my",
    "no",
    "of",
    "on",
    "or",
    "so",
    "to",
    "up",
    "us",
    "we",
    "ago",
    "all",
    "and"
  ],
  "2": [
    "kid",
    "man",
    "aunt",
    "baby",
    "girl",
    "child",
    "uncle",
    "woman",
    "cousin",
    "family",
    "father",
    "friend",
    "mother",
    "parent",
    "sister",
    "any",
    "but",
    "can",
    "cut",
    "day",
    "far",
    "for",
    "get",
    "has",
    "her",
    "him"
  ],
  "3": [
    "arm",
    "eye",
    "leg",
    "body",
    "face",
    "hair",
    "hand",
    "head",
    "neck",
    "nose",
    "tail",
    "his",
    "how",
    "its",
    "let",
    "lot",
    "may",
    "new",
    "not",
    "now",
    "off",
    "old",
    "one",
    "our",
    "out",
    "put"
  ],
  "4": [
    "red",
    "blue",
    "pink",
    "black",
    "brown",
    "green",
    "white",
    "colour",
    "yellow",
    "see",
    "she",
    "sit",
    "six",
    "ten",
    "the",
    "too",
    "try",
    "use",
    "way",
    "who",
    "why",
    "yes",
    "you",
    "back",
    "come",
    "down"
  ],
  "5": [
    "eat",
    "egg",
    "tea",
    "cake",
    "cook",
    "food",
    "meal",
    "meat",
    "milk",
    "soup",
    "apple",
    "bread",
    "drink",
    "fresh",
    "fruit",
    "grape",
    "juice",
    "lunch",
    "snack",
    "water",
    "banana",
    "coffee",
    "dinner",
    "noodle",
    "potato",
    "tomato"
  ],
  "6": [
    "ask",
    "bag",
    "cap",
    "pen",
    "book",
    "read",
    "word",
    "class",
    "learn",
    "maths",
    "paper",
    "ruler",
    "story",
    "study",
    "write",
    "answer",
    "crayon",
    "lesson",
    "letter",
    "pencil",
    "school",
    "fast",
    "find",
    "free",
    "from",
    "give"
  ],
  "7": [
    "bed",
    "box",
    "cup",
    "hat",
    "key",
    "coat",
    "desk",
    "door",
    "fork",
    "home",
    "live",
    "room",
    "shoe",
    "wall",
    "wear",
    "chair",
    "clean",
    "clock",
    "dress",
    "floor",
    "glass",
    "house",
    "shirt",
    "skirt",
    "sweep",
    "table"
  ],
  "8": [
    "air",
    "hot",
    "ice",
    "sea",
    "sun",
    "cold",
    "lake",
    "moon",
    "park",
    "star",
    "warm",
    "wind",
    "beach",
    "river",
    "windy",
    "autumn",
    "cloudy",
    "forest",
    "garden",
    "season",
    "spring",
    "summer",
    "winter",
    "half",
    "have"
  ],
  "9": [
    "bird",
    "duck",
    "farm",
    "fish",
    "lion",
    "horse",
    "panda",
    "sheep",
    "animal",
    "monkey",
    "rabbit",
    "bee",
    "cat",
    "cow",
    "dog",
    "fly",
    "pig",
    "zoo",
    "elephant",
    "hear",
    "help",
    "here",
    "hers",
    "high",
    "hold"
  ],
  "10": [
    "doll",
    "film",
    "game",
    "gift",
    "kite",
    "play",
    "show",
    "hobby",
    "party",
    "visit",
    "watch",
    "cinema",
    "travel",
    "tv",
    "buy",
    "fan",
    "toy",
    "holiday",
    "birthday",
    "hour",
    "idea",
    "into",
    "keep",
    "know",
    "late"
  ],
  "11": [
    "miss",
    "sell",
    "shop",
    "work",
    "nurse",
    "teach",
    "doctor",
    "driver",
    "famous",
    "farmer",
    "worker",
    "mr",
    "job",
    "mrs",
    "student",
    "teacher",
    "hospital",
    "line",
    "long",
    "look",
    "many",
    "meet",
    "move",
    "much",
    "must"
  ],
  "12": [
    "ball",
    "jump",
    "p.e.",
    "race",
    "swim",
    "walk",
    "catch",
    "sport",
    "run",
    "football",
    "name",
    "near",
    "need",
    "next",
    "nine",
    "noon",
    "open",
    "ours",
    "over",
    "p.m.",
    "some",
    "stay",
    "step",
    "take",
    "talk"
  ],
  "13": [
    "station",
    "bike",
    "ship",
    "taxi",
    "plane",
    "train",
    "because",
    "between",
    "goodbye",
    "morning",
    "o'clock",
    "welcome",
    "tomorrow",
    "tell",
    "that",
    "them",
    "then",
    "they",
    "thin",
    "this",
    "time",
    "turn",
    "very",
    "wait",
    "wake"
  ],
  "14": [
    "chinese",
    "hometown",
    "china",
    "earth",
    "world",
    "street",
    "wash",
    "week",
    "what",
    "when",
    "will",
    "with",
    "year",
    "your",
    "about",
    "after",
    "again",
    "begin",
    "bring",
    "close",
    "early",
    "every",
    "forty",
    "front",
    "heavy"
  ],
  "15": [
    "sing",
    "song",
    "dance",
    "music",
    "piano",
    "listen",
    "hello",
    "light",
    "money",
    "month",
    "never",
    "night",
    "often",
    "place",
    "right",
    "seven",
    "short",
    "sleep",
    "small",
    "space",
    "speak",
    "stand",
    "start",
    "still",
    "thank"
  ],
  "16": [
    "science",
    "computer",
    "internet",
    "email",
    "robot",
    "their",
    "there",
    "these",
    "thing",
    "think",
    "those",
    "three",
    "today",
    "under",
    "where",
    "which",
    "whose",
    "young",
    "always",
    "before",
    "behind",
    "beside",
    "choose",
    "eleven",
    "excuse"
  ],
  "17": [
    "tree",
    "grass",
    "plant",
    "flower",
    "little",
    "middle",
    "minute",
    "people",
    "please",
    "should",
    "sunday",
    "theirs",
    "afternoon",
    "september",
    "sometimes",
    "yesterday",
    "brother",
    "careful",
    "chicken",
    "clothes",
    "english",
    "excited",
    "healthy",
    "history",
    "kitchen"
  ],
  "18": [
    "picture",
    "draw",
    "make",
    "photo",
    "library",
    "subject",
    "sweater",
    "weather",
    "homework",
    "question",
    "trousers",
    "umbrella",
    "best",
    "busy",
    "cool",
    "dear",
    "easy",
    "feel",
    "fine",
    "glad",
    "good",
    "hard",
    "hope",
    "hurt",
    "kind"
  ],
  "19": [
    "bad",
    "cry",
    "ill",
    "sad",
    "like",
    "neat",
    "nice",
    "safe",
    "sick",
    "want",
    "well",
    "dirty",
    "enjoy",
    "great",
    "happy",
    "hurry",
    "quiet",
    "sorry",
    "tired",
    "worry",
    "wrong",
    "hungry",
    "lovely",
    "pretty",
    "strong"
  ],
  "20": [
    "art",
    "bus",
    "car",
    "map",
    "candle",
    "window",
    "beautiful",
    "breakfast",
    "chocolate",
    "classmate",
    "classroom",
    "difficult",
    "favourite",
    "ice-cream",
    "ping-pong",
    "schoolbag",
    "vegetable",
    "wonderful",
    "basketball",
    "blackboard",
    "playground",
    "grandfather",
    "grandmother",
    "interesting",
    "supermarket"
  ]
};
  
  let totalWords = 0;
  const usedWords = new Set();
  const duplicates = [];
  
  Object.keys(LEVEL_WORD_MAPPING).forEach(level => {
    const words = LEVEL_WORD_MAPPING[level];
    totalWords += words.length;
    
    words.forEach(wordKey => {
      if (usedWords.has(wordKey)) {
        duplicates.push(wordKey);
      } else {
        usedWords.add(wordKey);
      }
    });
  });
  
  return {
    totalWords,
    uniqueWords: usedWords.size,
    duplicates: duplicates.length,
    isValid: duplicates.length === 0 && totalWords === 507
  };
}

// 导出新函数（用于替换）
module.exports = {
  selectWordsForLevel,
  getLevelMappingStats,
  validateLevelMapping
};
