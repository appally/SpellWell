<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¾‹å¥æ’­æ”¾ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            background: #f9f9f9;
        }
        
        .test-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .word-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .word-display {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .word-text {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .word-meaning {
            font-size: 18px;
            color: #666;
            margin: 10px 0;
        }
        
        .sentence-area {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        
        .sentence-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .sentence-text {
            font-size: 16px;
            color: #333;
            line-height: 1.6;
            cursor: pointer;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .sentence-text:hover {
            border-color: #3498db;
            background: #e8f4fd;
        }
        
        .sentence-text.dictation {
            background: #fff3cd;
            border-color: #ffc107;
        }
        
        .sentence-text.dictation:hover {
            background: #fff3cd;
            border-color: #ff8c00;
        }
        
        .mode-indicator {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        
        .mode-learn {
            background: #27ae60;
        }
        
        .mode-dictation {
            background: #f39c12;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }
        
        .log-area {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-info {
            color: #3498db;
        }
        
        .log-success {
            color: #27ae60;
        }
        
        .log-warning {
            color: #f39c12;
        }
        
        .log-error {
            color: #e74c3c;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success {
            background: #27ae60;
        }
        
        .status-warning {
            background: #f39c12;
        }
        
        .status-error {
            background: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”Š ä¾‹å¥æ’­æ”¾ä¿®å¤æµ‹è¯•</h1>
        
        <div class="test-section">
            <div class="test-title">
                ğŸ“š å­¦ä¹ æ¨¡å¼æµ‹è¯•
                <span class="mode-indicator mode-learn">LEARN</span>
            </div>
            
            <div class="word-card">
                <div class="word-display">
                    <div class="word-text" id="learnWord">apple</div>
                    <div class="word-meaning">è‹¹æœ</div>
                </div>
                
                <div class="sentence-area">
                    <div class="sentence-label">ğŸ“š è¯»ä¸€è¯»ä¾‹å¥ï¼š</div>
                    <div class="sentence-text" id="learnSentence" onclick="testLearnMode()">
                        I like to eat an apple every day.
                    </div>
                </div>
                
                <div class="control-buttons">
                    <button class="btn btn-primary" onclick="switchToLearnMode()">åˆ‡æ¢åˆ°å­¦ä¹ æ¨¡å¼</button>
                    <button class="btn btn-success" onclick="testLearnMode()">æ’­æ”¾å­¦ä¹ æ¨¡å¼ä¾‹å¥</button>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">
                âœï¸ é»˜å†™æ¨¡å¼æµ‹è¯•
                <span class="mode-indicator mode-dictation">DICTATION</span>
            </div>
            
            <div class="word-card">
                <div class="word-display">
                    <div class="word-text" id="dictationWord">apple</div>
                    <div class="word-meaning">è‹¹æœ</div>
                </div>
                
                <div class="sentence-area">
                    <div class="sentence-label">ğŸ“š è¯»ä¸€è¯»ä¾‹å¥ï¼š</div>
                    <div class="sentence-text dictation" id="dictationSentence" onclick="testDictationMode()">
                        I like to eat an _____ every day.
                    </div>
                </div>
                
                <div class="control-buttons">
                    <button class="btn btn-warning" onclick="switchToDictationMode()">åˆ‡æ¢åˆ°é»˜å†™æ¨¡å¼</button>
                    <button class="btn btn-success" onclick="testDictationMode()">æ’­æ”¾é»˜å†™æ¨¡å¼ä¾‹å¥</button>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">
                ğŸ”„ æ¨¡å¼åˆ‡æ¢æµ‹è¯•
            </div>
            
            <div class="control-buttons">
                <button class="btn btn-primary" onclick="testModeSwitch()">æµ‹è¯•å¿«é€Ÿæ¨¡å¼åˆ‡æ¢</button>
                <button class="btn btn-warning" onclick="testDataConsistency()">æµ‹è¯•æ•°æ®ä¸€è‡´æ€§</button>
                <button class="btn btn-success" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
            </div>
        </div>
        
        <div class="log-area" id="logArea">
            <div class="log-entry log-info">ğŸš€ ä¾‹å¥æ’­æ”¾ä¿®å¤æµ‹è¯•å·²å¯åŠ¨</div>
            <div class="log-entry log-info">ğŸ“‹ æµ‹è¯•è¯´æ˜ï¼šç‚¹å‡»ä¾‹å¥æ–‡æœ¬æˆ–æŒ‰é’®æ¥æµ‹è¯•æ’­æ”¾åŠŸèƒ½</div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿå°ç¨‹åºç¯å¢ƒ
        const wx = {
            showToast: function(options) {
                addLog(`ğŸ“± Toast: ${options.title}`, 'warning');
                alert(options.title);
            }
        };
        
        // æ¨¡æ‹ŸéŸ³é¢‘æœåŠ¡
        function playSentencePronunciation(text) {
            return new Promise((resolve, reject) => {
                addLog(`ğŸµ æ’­æ”¾ä¾‹å¥: "${text}"`, 'success');
                
                // æ¨¡æ‹Ÿæ’­æ”¾å»¶è¿Ÿ
                setTimeout(() => {
                    if (Math.random() > 0.1) { // 90% æˆåŠŸç‡
                        addLog(`âœ… æ’­æ”¾æˆåŠŸ: "${text}"`, 'success');
                        resolve();
                    } else {
                        addLog(`âŒ æ’­æ”¾å¤±è´¥: "${text}"`, 'error');
                        reject(new Error('æ¨¡æ‹Ÿæ’­æ”¾å¤±è´¥'));
                    }
                }, 500);
            });
        }
        
        // æ¨¡æ‹Ÿé¡µé¢æ•°æ®
        let pageData = {
            currentWord: {
                word: 'apple',
                chinese: 'è‹¹æœ',
                sentence: 'I like to eat an apple every day.'
            },
            sentenceWithBlank: '',
            mode: 'learn'
        };
        
        // æ¨¡æ‹Ÿ onPlaySentence æ–¹æ³•ï¼ˆä¿®å¤åçš„ç‰ˆæœ¬ï¼‰
        function onPlaySentence() {
            const { currentWord, sentenceWithBlank, mode } = pageData;
            
            addLog('ğŸ”Š å¼€å§‹æ’­æ”¾ä¾‹å¥', 'info');
            addLog(`ğŸ“‹ å½“å‰æ¨¡å¼: ${mode}`, 'info');
            addLog(`ğŸ“ å½“å‰å•è¯: ${JSON.stringify(currentWord)}`, 'info');
            addLog(`ğŸ“„ å¸¦ç©ºç™½ä¾‹å¥: "${sentenceWithBlank}"`, 'info');
            
            // ç¡®å®šè¦æ’­æ”¾çš„ä¾‹å¥å†…å®¹
            let sentenceText = '';
            
            if (mode === 'dictation' && sentenceWithBlank) {
                // é»˜å†™æ¨¡å¼ï¼šæ’­æ”¾å®Œæ•´ä¾‹å¥ï¼ˆå°†ç©ºç™½æ›¿æ¢ä¸ºå•è¯ï¼‰
                const blankPattern = /_+/g;
                sentenceText = sentenceWithBlank.replace(blankPattern, currentWord.word);
                addLog(`ğŸ¯ é»˜å†™æ¨¡å¼ - æ’­æ”¾å®Œæ•´ä¾‹å¥: "${sentenceText}"`, 'info');
            } else if (mode === 'learn' && currentWord && currentWord.sentence) {
                // å­¦ä¹ æ¨¡å¼ï¼šæ’­æ”¾å®Œæ•´ä¾‹å¥
                sentenceText = currentWord.sentence;
                addLog(`ğŸ“š å­¦ä¹ æ¨¡å¼ - æ’­æ”¾å®Œæ•´ä¾‹å¥: "${sentenceText}"`, 'info');
            } else {
                // å…œåº•é€»è¾‘ï¼šå°è¯•ä½¿ç”¨å½“å‰å•è¯çš„ä¾‹å¥
                if (currentWord && currentWord.sentence) {
                    sentenceText = currentWord.sentence;
                    addLog(`ğŸ”„ å…œåº•é€»è¾‘ - ä½¿ç”¨å½“å‰å•è¯ä¾‹å¥: "${sentenceText}"`, 'warning');
                }
            }
            
            if (!sentenceText) {
                addLog('âŒ æ— æ³•ç¡®å®šè¦æ’­æ”¾çš„ä¾‹å¥å†…å®¹', 'error');
                addLog('ğŸ“Š è°ƒè¯•ä¿¡æ¯:', 'error');
                addLog(`  - mode: ${mode}`, 'error');
                addLog(`  - currentWord: ${JSON.stringify(currentWord)}`, 'error');
                addLog(`  - sentenceWithBlank: "${sentenceWithBlank}"`, 'error');
                
                wx.showToast({
                    title: 'ä¾‹å¥æ•°æ®æ— æ•ˆ',
                    icon: 'none'
                });
                return;
            }

            addLog(`âœ… ç¡®å®šæ’­æ”¾ä¾‹å¥: "${sentenceText}"`, 'success');
            
            playSentencePronunciation(sentenceText)
                .then(() => {
                    addLog(`ğŸµ æ’­æ”¾ä¾‹å¥æˆåŠŸ: "${sentenceText}"`, 'success');
                })
                .catch((error) => {
                    addLog(`âŒ æ’­æ”¾ä¾‹å¥å¤±è´¥: ${error.message}`, 'error');
                    wx.showToast({
                        title: 'ä¾‹å¥æ’­æ”¾å¤±è´¥',
                        icon: 'none'
                    });
                });
        }
        
        // æ¨¡æ‹Ÿ createSentenceWithBlank æ–¹æ³•
        function createSentenceWithBlank(sentence, word) {
            if (!sentence || !word) return '';
            
            // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å•è¯ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
            const regex = new RegExp(`\\b${word}\\b`, 'gi');
            const blank = '_'.repeat(word.length);
            return sentence.replace(regex, blank);
        }
        
        // æµ‹è¯•å‡½æ•°
        function testLearnMode() {
            addLog('ğŸ§ª æµ‹è¯•å­¦ä¹ æ¨¡å¼ä¾‹å¥æ’­æ”¾', 'info');
            onPlaySentence();
        }
        
        function testDictationMode() {
            addLog('ğŸ§ª æµ‹è¯•é»˜å†™æ¨¡å¼ä¾‹å¥æ’­æ”¾', 'info');
            onPlaySentence();
        }
        
        function switchToLearnMode() {
            addLog('ğŸ”„ åˆ‡æ¢åˆ°å­¦ä¹ æ¨¡å¼', 'info');
            pageData.mode = 'learn';
            pageData.sentenceWithBlank = '';
            
            // æ›´æ–°UI
            document.getElementById('learnSentence').textContent = pageData.currentWord.sentence;
            
            addLog('âœ… å­¦ä¹ æ¨¡å¼æ•°æ®è®¾ç½®å®Œæˆï¼Œå·²æ¸…é™¤é»˜å†™æ¨¡å¼æ®‹ç•™æ•°æ®', 'success');
        }
        
        function switchToDictationMode() {
            addLog('ğŸ”„ åˆ‡æ¢åˆ°é»˜å†™æ¨¡å¼', 'info');
            pageData.mode = 'dictation';
            
            // ç”Ÿæˆå¡«ç©ºå¥å­
            addLog('ğŸ“ ç”Ÿæˆå¡«ç©ºå¥å­:', 'info');
            addLog(`  - åŸå§‹ä¾‹å¥: "${pageData.currentWord.sentence}"`, 'info');
            addLog(`  - ç›®æ ‡å•è¯: "${pageData.currentWord.word}"`, 'info');
            
            const sentenceWithBlank = createSentenceWithBlank(pageData.currentWord.sentence, pageData.currentWord.word);
            pageData.sentenceWithBlank = sentenceWithBlank;
            
            addLog(`  - ç”Ÿæˆçš„å¡«ç©ºå¥å­: "${sentenceWithBlank}"`, 'info');
            
            // æ›´æ–°UI
            document.getElementById('dictationSentence').textContent = sentenceWithBlank;
            
            addLog('âœ… é»˜å†™æ¨¡å¼æ•°æ®è®¾ç½®å®Œæˆ:', 'success');
            addLog(`  - mode: ${pageData.mode}`, 'success');
            addLog(`  - sentenceWithBlank: "${pageData.sentenceWithBlank}"`, 'success');
        }
        
        function testModeSwitch() {
            addLog('ğŸ§ª å¼€å§‹å¿«é€Ÿæ¨¡å¼åˆ‡æ¢æµ‹è¯•', 'info');
            
            // å¿«é€Ÿåˆ‡æ¢æ¨¡å¼å¹¶æµ‹è¯•æ’­æ”¾
            setTimeout(() => {
                switchToLearnMode();
                setTimeout(() => {
                    testLearnMode();
                    setTimeout(() => {
                        switchToDictationMode();
                        setTimeout(() => {
                            testDictationMode();
                            addLog('âœ… å¿«é€Ÿæ¨¡å¼åˆ‡æ¢æµ‹è¯•å®Œæˆ', 'success');
                        }, 1000);
                    }, 1000);
                }, 1000);
            }, 500);
        }
        
        function testDataConsistency() {
            addLog('ğŸ§ª å¼€å§‹æ•°æ®ä¸€è‡´æ€§æµ‹è¯•', 'info');
            
            // æµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µ
            const originalData = { ...pageData };
            
            // æµ‹è¯•1ï¼šç©ºæ•°æ®
            pageData.currentWord = null;
            addLog('ğŸ” æµ‹è¯•ç©ºå•è¯æ•°æ®', 'warning');
            onPlaySentence();
            
            // æ¢å¤æ•°æ®
            pageData = { ...originalData };
            
            setTimeout(() => {
                // æµ‹è¯•2ï¼šç¼ºå°‘ä¾‹å¥
                pageData.currentWord = { word: 'test', chinese: 'æµ‹è¯•' };
                addLog('ğŸ” æµ‹è¯•ç¼ºå°‘ä¾‹å¥æ•°æ®', 'warning');
                onPlaySentence();
                
                // æ¢å¤æ•°æ®
                pageData = { ...originalData };
                
                setTimeout(() => {
                    // æµ‹è¯•3ï¼šæ¨¡å¼ä¸åŒ¹é…
                    pageData.mode = 'unknown';
                    addLog('ğŸ” æµ‹è¯•æœªçŸ¥æ¨¡å¼', 'warning');
                    onPlaySentence();
                    
                    // æ¢å¤æ•°æ®
                    pageData = { ...originalData };
                    addLog('âœ… æ•°æ®ä¸€è‡´æ€§æµ‹è¯•å®Œæˆ', 'success');
                }, 2000);
            }, 2000);
        }
        
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function clearLogs() {
            const logArea = document.getElementById('logArea');
            logArea.innerHTML = '<div class="log-entry log-info">ğŸ§¹ æ—¥å¿—å·²æ¸…é™¤</div>';
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ¯ é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡å¼€å§‹æµ‹è¯•', 'success');
            addLog('ğŸ’¡ æç¤ºï¼šç‚¹å‡»ä¾‹å¥æ–‡æœ¬æˆ–ä½¿ç”¨æ§åˆ¶æŒ‰é’®è¿›è¡Œæµ‹è¯•', 'info');
            
            // åˆå§‹åŒ–ä¸ºå­¦ä¹ æ¨¡å¼
            switchToLearnMode();
        });
    </script>
</body>
</html>