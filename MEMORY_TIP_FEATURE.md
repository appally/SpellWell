# 单词记忆方法功能实现文档

## 功能概述

在单词默写页面，当用户错误拼写3次后，系统会弹窗提示用户该单词的记忆方法，帮助小学生更好地记住单词。

## 核心特性

### 1. 智能预加载机制
- **触发时机**：用户错误2次后自动开始预加载
- **目的**：确保第3次错误时能流畅显示记忆内容
- **技术实现**：异步调用AI服务，避免阻塞用户操作

### 2. 专业的记忆方法提示词
基于儿童学习特点优化的提示词：
```
你是一位儿童英语启蒙教育家，风趣幽默，充满想象力，尤其擅长将复杂的英语单词用词根或的方式讲给10岁左右的中国小学生听。

现在，请你为下面的目标单词提供不超过 200 字的讲解。

目标单词：[单词]

语言风格必须生动、有趣，多使用比喻和拟人，就像在和一位小朋友面对面讲故事：

1. **【记忆魔法画】**：创造一个非常有趣、夸张、甚至有点好笑的故事或画面，将单词的形状和意思联系起来。这是讲解的核心。
2. **【神奇积木屋】**（可选）：如果这个单词有非常简单、常见的"积木块"（即词根词缀，但不要使用这些术语），请用"一个神奇的积木"这样的比喻来解释它。
3. **【趣味小贴士】**：给出该单词相关的变形、复法、时态，近义词等。
```

### 3. 用户友好的交互设计
- **弹窗设计**：采用Neo-Brutalism风格，符合应用整体设计
- **操作选项**：
  - 继续练习：重置错误次数，让用户再次尝试
  - 跳过单词：记录跳过行为，继续下一个单词
- **加载状态**：显示友好的加载动画和提示文字

## 技术实现

### 1. 数据结构扩展

在 `word-learning.js` 的 `data` 中新增：
```javascript
// 记忆方法相关
memoryTipContent: '',        // 记忆方法内容
showMemoryTip: false,        // 是否显示记忆方法弹窗
memoryTipLoading: false,     // 记忆方法加载状态
preloadingMemoryTip: false,  // 是否正在预加载
```

### 2. 核心函数

#### `preloadMemoryTip()`
- **功能**：预加载记忆方法
- **触发时机**：用户错误2次后
- **实现**：异步调用AI服务，缓存结果

#### `generateMemoryTip(word)`
- **功能**：生成记忆方法内容
- **参数**：单词字符串
- **返回**：Promise<string> 记忆方法内容
- **降级方案**：AI服务失败时提供基础记忆提示

#### `showMemoryTipModal()`
- **功能**：显示记忆方法弹窗
- **逻辑**：
  - 如果有预加载内容，直接显示
  - 否则现场生成并显示加载状态

#### `generateFallbackMemoryTip(word)`
- **功能**：生成降级记忆方法
- **用途**：AI服务不可用时的备选方案

### 3. 修改的现有函数

#### `onSubmitDictation()`
新增逻辑：
```javascript
// 错误2次后开始预加载记忆方法
if (newAttempts === 2 && !this.data.preloadingMemoryTip) {
  this.preloadMemoryTip()
}

if (newAttempts >= maxAttempts) {
  // 达到最大尝试次数，显示记忆方法弹窗
  this.showMemoryTipModal()
}
```

#### `loadCurrentWord()`
新增状态重置：
```javascript
// 重置记忆方法相关状态
memoryTipContent: '',
showMemoryTip: false,
memoryTipLoading: false,
preloadingMemoryTip: false
```

### 4. UI组件

#### 记忆方法弹窗 (memory-tip-modal)
- **位置**：`word-learning.wxml` 末尾
- **结构**：
  - 遮罩层
  - 弹窗容器
    - 头部（标题 + 关闭按钮）
    - 单词信息
    - 记忆方法内容
    - 操作按钮

#### 样式特点
- **设计风格**：Neo-Brutalism
- **颜色方案**：与应用主题一致
- **动画效果**：淡入 + 滑入动画
- **响应式**：适配不同屏幕尺寸

## 测试步骤

### 1. 基础功能测试
1. 进入任意关卡的单词学习页面
2. 选择"学会了"进入默写模式
3. 故意输入错误答案2次
4. 观察是否开始预加载（控制台日志）
5. 第3次输入错误答案
6. 验证是否弹出记忆方法弹窗

### 2. 预加载机制测试
1. 按上述步骤操作到第2次错误
2. 等待1-2秒（预加载时间）
3. 第3次错误后观察弹窗显示速度
4. 应该立即显示内容，无明显加载延迟

### 3. AI服务测试
1. 网络正常情况下测试AI生成的记忆方法
2. 断网情况下测试降级方案
3. 验证内容是否符合儿童学习特点

### 4. 交互测试
1. 点击"继续练习"按钮
   - 验证弹窗关闭
   - 验证错误次数重置
   - 验证可以重新输入
2. 点击"跳过单词"按钮
   - 验证弹窗关闭
   - 验证进入下一个单词
   - 验证错误记录

### 5. 状态重置测试
1. 触发记忆方法弹窗后
2. 进入下一个单词
3. 验证记忆方法相关状态是否正确重置

## 注意事项

### 1. 性能优化
- 预加载机制避免了用户等待
- AI服务调用有重试机制
- 降级方案确保功能可用性

### 2. 用户体验
- 记忆方法内容针对小学生优化
- 弹窗设计符合应用整体风格
- 操作简单明确

### 3. 错误处理
- AI服务失败时自动降级
- 网络异常时提供本地内容
- 所有异常都有日志记录

### 4. 数据记录
- 记录用户跳过行为
- 记录错误类型和次数
- 便于后续分析和优化

## 相关文件

- `pages/word-learning/word-learning.js` - 主要逻辑实现
- `pages/word-learning/word-learning.wxml` - UI模板
- `pages/word-learning/word-learning.wxss` - 样式定义
- `utils/ai-service.js` - AI服务调用
- `utils/data-manager.js` - 数据管理

## 后续优化建议

1. **内容个性化**：根据用户学习历史调整记忆方法
2. **多媒体支持**：添加图片、音频等辅助记忆
3. **效果追踪**：统计记忆方法的有效性
4. **内容缓存**：缓存常用单词的记忆方法
5. **离线支持**：预置常用单词的记忆方法